<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mx.argal.cp.dao.SolicitudDao">

	<resultMap type="SolicitudCirugiaProgramada" id="solicitudCirugiaProgramadaResult">
		<id property="idSolicitudCirugiaProgramada" column="ID_SOLICITUD_CIRUGIA_PROGRAMADA"/>
		<result property="nombreBeneficiarioSolicitudCirugiaProgramada" column="NOMBRE_BENEFICIARIO"/>
		<result property="apPBeneficiarioSolicitudCirugiaProgramada" column="APP_BENEFICIARIO"/>
		<result property="apMBeneficiarioSolicitudCirugiaProgramada" column="APM_BENEFICIARIO"/>
		<result property="edadBeneficiarioSolicitudCirugiaProgramada" column="EDAD_BENEFICIARIO"/>
		<result property="sexoBeneficiarioSolicitudCirugiaProgramada" column="SEXO_BENEFICIARIO"/>		
		<result property="numNominaBeneficiarioSolicitudCirugiaProgramada" column="NUM_NOMINA_BENEFICIARIO"/>
		<result property="fechaSolicitudCirugiaProgramada" column="FECHA_SOLICITUD"/>
		<result property="fechaSolicitudElaboracion" column="FECHA_SOLICITUD_CREACION"/>		
		<result property="empresaBeneficiarioSolicitudCirugiaProgramada" column="EMPRESA_BENEFICIARIO"/>		
		<result property="tipoSolicitudCirugiaProgramada" column="TIPO_CIRUGIA_PROGRAMADA"/>
		<result property="status" column="STATUS"/>	
		<association property="medicoTratante" column="ID_MEDICO_TRATANTE" javaType="MedicoTratante" select="selectMedicoTratante"/>				
	</resultMap>

	<resultMap id="medicoTratanteResult" type="MedicoTratante">
	    	<id property="idMedicoTratante" column="ID_MEDICO_TRATANTE" />
	</resultMap>

	<select id="selectMedicoTratante" parameterType="int" resultMap="medicoTratanteResult" resultType="MedicoTratante">		 
		select "ID_MEDICO_TRATANTE" from "MEDICO_TRATANTE" where "ID_MEDICO_TRATANTE"=#{idMedicoTratante} 	
	</select> 

	<select id="obtenerSolicitudes" resultMap="solicitudCirugiaProgramadaResult">
		select * from "SOLICITUD_CIRUGIA_PROGRAMADA";
	</select>
	
	<select id="getSolicitudById" resultMap="solicitudCirugiaProgramadaResult">
		select * from "SOLICITUD_CIRUGIA_PROGRAMADA" where "ID_SOLICITUD_CIRUGIA_PROGRAMADA"=#{idSolicitudCirugiaProgramada};
	</select>
	
	<select id="obtenerSolicitudesByMedTrat" parameterType="map" resultMap="solicitudCirugiaProgramadaResult">
		select * from "SOLICITUD_CIRUGIA_PROGRAMADA" where "ID_MEDICO_TRATANTE"=
		(select "ID_MEDICO_TRATANTE" FROM "MEDICO_TRATANTE" WHERE "id_t_usuario"=#{idMedicoTratante});
	</select>
		
	<insert id="guardarSolicitud" parameterType="SolicitudCirugiaProgramada"  keyProperty="id">
		<selectKey keyProperty="id" resultType="long" order="BEFORE">
  		   	SELECT nextVal('sec_solicitud_c_p')
  		</selectKey>	
		INSERT INTO "SOLICITUD_CIRUGIA_PROGRAMADA"(
			"ID_SOLICITUD_CIRUGIA_PROGRAMADA","STATUS","ID_MEDICO_TRATANTE") VALUES (#{id},1,#{medicoTratante.idMedicoTratante})
	</insert>
	
	<update id="guardarSolicitudByParams" parameterType="SolicitudCirugiaProgramada">
			UPDATE "SOLICITUD_CIRUGIA_PROGRAMADA" SET
		<if test="nombreBeneficiarioSolicitudCirugiaProgramada != null">
			"ID_SOLICITUD_CIRUGIA_PROGRAMADA"=#{idSolicitudCirugiaProgramada} 
		</if>
		<if test="nombreBeneficiarioSolicitudCirugiaProgramada != null">
			,"NOMBRE_BENEFICIARIO"=#{nombreBeneficiarioSolicitudCirugiaProgramada}
		</if>
		<if test="apPBeneficiarioSolicitudCirugiaProgramada != null">
			,"APP_BENEFICIARIO"=#{apPBeneficiarioSolicitudCirugiaProgramada}
		</if>
		<if test="apMBeneficiarioSolicitudCirugiaProgramada != null">
			,"APM_BENEFICIARIO"=#{apMBeneficiarioSolicitudCirugiaProgramada}
		</if>
		<if test="empresaBeneficiarioSolicitudCirugiaProgramada != null">	
			,"EMPRESA_BENEFICIARIO"=#{empresaBeneficiarioSolicitudCirugiaProgramada}
		</if>
		<if test="numNominaBeneficiarioSolicitudCirugiaProgramada != null">	
			,"NUM_NOMINA_BENEFICIARIO"=#{numNominaBeneficiarioSolicitudCirugiaProgramada}
		</if>
		<if test="fechaSolicitudCirugiaProgramada != null">	
			,"FECHA_SOLICITUD"=date(#{fechaSolicitudCirugiaProgramada})
		</if>
		<if test="tipoSolicitudCirugiaProgramada != null">
			,"TIPO_CIRUGIA_PROGRAMADA"=#{tipoSolicitudCirugiaProgramada}
		</if>
		<if test="edadBeneficiarioSolicitudCirugiaProgramada != null">	
			,"EDAD_BENEFICIARIO"=cast(#{edadBeneficiarioSolicitudCirugiaProgramada} as int)
		</if>
		<if test="sexoBeneficiarioSolicitudCirugiaProgramada != null">
			,"SEXO_BENEFICIARIO"=#{sexoBeneficiarioSolicitudCirugiaProgramada}
		</if>	
			WHERE "ID_SOLICITUD_CIRUGIA_PROGRAMADA"=#{idSolicitudCirugiaProgramada}
	</update>
	
</mapper>